# Workflow: colcon-action-runner
#
# This GitHub Actions workflow, named "colcon-action-runner,"
# is designed to be triggered on workflow calls.
# This action build, tests and run coverage with ROS or ROS 2 workspace from source.
#
# Trigger
# This workflow is triggered by a `workflow_call` event.
# Thirdparty actions
# https://github.com/marketplace/actions/ros-2-ci-action
# Comments a pull request with the code coverage generated by your tests.
# https://github.com/marketplace/ros-tooling/setup-ros

name: colcon-action-runner

on: [pull_request, workflow_dispatch]

jobs:
  setup-colcon-ci:
    strategy:
      fail-fast: false
      matrix:
        ubuntu: [jammy]
        distro: [humble]
    runs-on: ubuntu-latest
    container:
      image: rostooling/setup-ros-docker:ubuntu-${{ matrix.ubuntu }}-latest

    name: run ${{ matrix.distro }} on colcon
    steps:
      - name: setup ros environment
        uses: ros-tooling/setup-ros@v0.7
        with:
          required-ros-distributions: ${{ matrix.distro }}
      - name: build - ${{ github.event.repository.name }}
        uses: ros-tooling/action-ros-ci@v0.3
        with:
          package-name: |
            ${{ github.event.repository.name }}
          target-ros2-distro: ${{ matrix.distro }}
          skip-tests: true
          no-symlink-install: true
          colcon-extra-args: --event-handlers console_direct+ --executor sequential
          colcon-defaults: |
            {
              "build": {
                "cmake-args": [
                  "-DCMAKE_BUILD_TYPE=Debug"
                ]
              }
            }
          colcon-mixin-repository: https://raw.githubusercontent.com/colcon/colcon-mixin-repository/1ddb69bedfd1f04c2f000e95452f7c24a4d6176b/index.yaml
